<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Netlify CMS Admin Dashboard - Manage GNTT Content" />
  <meta name="robots" content="noindex, nofollow" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <title>Admin Dashboard ‚Äî Guru Nanak Tour & Travels</title>
  
  <!-- Favicons -->
  <link rel="icon" href="https://i.ibb.co/wFXBHmNh/image.png" type="image/png" />
  <link rel="apple-touch-icon" href="https://i.ibb.co/wFXBHmNh/image.png" />
  <link rel="shortcut icon" href="https://i.ibb.co/wFXBHmNh/image.png" />
  
  <!-- Netlify Identity Widget -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
  
  <style>
    /* =====================================================
       RESET & ROOT VARIABLES
       ===================================================== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --pri: #0a3d62;
      --brand: #0e5aa7;
      --sec: #f39c12;
      --text: #1f2937;
      --bg: #f5f7fa;
      --shadow: 0 10px 30px rgba(0,0,0,0.15);
      --radius: 0.75rem;
      --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* =====================================================
       BASE STYLES
       ===================================================== */
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      line-height: 1.6;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      overflow-x: hidden;
    }

    /* =====================================================
       LOADING SCREEN
       ===================================================== */
    .cms-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, var(--pri) 0%, var(--brand) 100%);
      color: white;
      padding: 2rem;
      text-align: center;
      position: fixed;
      inset: 0;
      z-index: 9999;
      transition: var(--transition);
    }

    .cms-loading.hidden {
      opacity: 0;
      pointer-events: none;
      transform: scale(0.95);
    }

    .loading-logo {
      width: 100px;
      height: 100px;
      margin-bottom: 2rem;
      border-radius: 50%;
      border: 4px solid rgba(255,255,255,0.3);
      animation: pulse 2s ease-in-out infinite;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }

    @keyframes pulse {
      0%, 100% { 
        transform: scale(1); 
        opacity: 1;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      }
      50% { 
        transform: scale(1.05); 
        opacity: 0.8;
        box-shadow: 0 15px 40px rgba(0,0,0,0.3);
      }
    }

    .cms-loading h1 {
      font-size: 2rem;
      font-weight: 900;
      margin-bottom: 0.5rem;
      letter-spacing: -0.02em;
      text-shadow: 0 2px 10px rgba(0,0,0,0.2);
    }

    .cms-loading p {
      font-size: 1rem;
      opacity: 0.9;
      margin-bottom: 2rem;
    }

    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-top: 4px solid white;
      border-radius: 50%;
      width: 50px;
      height: 50px;
      animation: spin 1s linear infinite;
      margin-bottom: 1rem;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .loading-status {
      font-size: 0.9rem;
      opacity: 0.8;
      margin-top: 1rem;
      font-weight: 500;
    }

    /* =====================================================
       AUTHENTICATION ERROR
       ===================================================== */
    .auth-error {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #dc2626 0%, #ef4444 100%);
      color: white;
      padding: 2rem;
      text-align: center;
      position: fixed;
      inset: 0;
      z-index: 9998;
    }

    .auth-error.show {
      display: flex;
      animation: fadeIn 0.5s var(--transition);
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }

    .auth-error-icon {
      font-size: 4rem;
      margin-bottom: 1rem;
      animation: shake 0.5s ease-in-out;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px); }
      75% { transform: translateX(10px); }
    }

    .auth-error h1 {
      font-size: 1.75rem;
      font-weight: 900;
      margin-bottom: 0.75rem;
      letter-spacing: -0.02em;
    }

    .auth-error p {
      font-size: 1rem;
      opacity: 0.95;
      margin-bottom: 2rem;
      max-width: 400px;
      line-height: 1.6;
    }

    .auth-error-btn {
      padding: 0.875rem 2.5rem;
      background: white;
      color: #dc2626;
      border: none;
      border-radius: var(--radius);
      font-size: 1rem;
      font-weight: 700;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .auth-error-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.25);
      background: #f9fafb;
    }

    .auth-error-btn:active {
      transform: translateY(-1px);
    }

    /* =====================================================
       SUCCESS MESSAGE
       ===================================================== */
    .success-message {
      position: fixed;
      top: 2rem;
      right: 2rem;
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
      padding: 1rem 1.5rem;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      display: none;
      align-items: center;
      gap: 0.75rem;
      z-index: 10000;
      animation: slideInRight 0.5s var(--transition);
    }

    @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }

    .success-message.show {
      display: flex;
    }

    .success-icon {
      font-size: 1.5rem;
    }

    /* =====================================================
       RESPONSIVE DESIGN
       ===================================================== */
    @media (max-width: 768px) {
      .cms-loading h1 { 
        font-size: 1.5rem; 
      }
      
      .loading-logo { 
        width: 80px; 
        height: 80px; 
      }
      
      .spinner { 
        width: 40px; 
        height: 40px; 
      }

      .auth-error h1 {
        font-size: 1.35rem;
      }

      .auth-error-btn {
        padding: 0.75rem 2rem;
        font-size: 0.95rem;
      }

      .success-message {
        top: 1rem;
        right: 1rem;
        left: 1rem;
        font-size: 0.9rem;
      }
    }

    @media (max-width: 480px) {
      .cms-loading {
        padding: 1.5rem;
      }

      .cms-loading h1 {
        font-size: 1.25rem;
      }

      .loading-logo {
        width: 70px;
        height: 70px;
      }
    }

    /* =====================================================
       SCROLLBAR STYLING
       ===================================================== */
    ::-webkit-scrollbar { 
      width: 10px; 
      height: 10px;
    }
    
    ::-webkit-scrollbar-track { 
      background: #f1f5f9; 
      border-radius: 10px;
    }
    
    ::-webkit-scrollbar-thumb { 
      background: var(--brand);
      border-radius: 10px;
      border: 2px solid #f1f5f9;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--pri);
    }

    /* =====================================================
       ACCESSIBILITY
       ===================================================== */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }

    /* Focus styles */
    *:focus-visible {
      outline: 3px solid var(--sec);
      outline-offset: 2px;
    }

    /* =====================================================
       PRINT STYLES
       ===================================================== */
    @media print {
      .cms-loading,
      .auth-error,
      .success-message {
        display: none !important;
      }
    }

    /* =====================================================
       DARK MODE SUPPORT
       ===================================================== */
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #1f2937;
        --text: #f9fafb;
      }
    }
  </style>
</head>
<body>
  <!-- Loading Screen -->
  <div id="cms-loading" class="cms-loading" role="status" aria-live="polite">
    <img 
      src="https://i.ibb.co/wFXBHmNh/image.png" 
      alt="GNTT Logo" 
      class="loading-logo"
      width="100"
      height="100"
    />
    <h1>GNTT Admin Dashboard</h1>
    <p>Loading Netlify CMS...</p>
    <div class="spinner" role="progressbar" aria-label="Loading">
      <span class="sr-only">Loading content management system...</span>
    </div>
    <div class="loading-status" id="loadingStatus" aria-live="polite">Initializing...</div>
  </div>

  <!-- Authentication Error -->
  <div id="auth-error" class="auth-error" role="alert" aria-live="assertive">
    <div class="auth-error-icon" aria-hidden="true">üîí</div>
    <h1>Authentication Required</h1>
    <p>You must be logged in with an authorized account to access the admin dashboard.</p>
    <button class="auth-error-btn" onclick="netlifyIdentity.open()" type="button">
      Sign In
    </button>
  </div>

  <!-- Success Message -->
  <div id="success-message" class="success-message" role="status" aria-live="polite">
    <span class="success-icon" aria-hidden="true">‚úì</span>
    <span id="success-text">Successfully logged in!</span>
  </div>

  <!-- Netlify CMS -->
  <script src="https://unpkg.com/netlify-cms@^2.10.192/dist/netlify-cms.js"></script>

  <!-- Custom Admin Scripts -->
  <script>
    (function() {
      'use strict';

      console.log('[ADMIN] üöÄ Initializing GNTT Admin Dashboard...');

      // DOM Elements
      const loadingScreen = document.getElementById('cms-loading');
      const authError = document.getElementById('auth-error');
      const loadingStatus = document.getElementById('loadingStatus');
      const successMessage = document.getElementById('success-message');
      const successText = document.getElementById('success-text');

      // Utility Functions
      function updateStatus(message) {
        if (loadingStatus) {
          loadingStatus.textContent = message;
        }
        console.log('[ADMIN]', message);
      }

      function showLoading() {
        loadingScreen.classList.remove('hidden');
        authError.classList.remove('show');
        successMessage.classList.remove('show');
      }

      function hideLoading() {
        setTimeout(() => {
          loadingScreen.classList.add('hidden');
        }, 500);
      }

      function showAuthError() {
        loadingScreen.classList.add('hidden');
        authError.classList.add('show');
      }

      function showSuccess(message = 'Successfully logged in!') {
        successText.textContent = message;
        successMessage.classList.add('show');
        setTimeout(() => {
          successMessage.classList.remove('show');
        }, 3000);
      }

      // Initialize Netlify Identity
      if (window.netlifyIdentity) {
        updateStatus('üîê Checking authentication...');

        netlifyIdentity.on('init', user => {
          updateStatus('‚úì Authentication check complete');

          if (!user) {
            console.log('[ADMIN] ‚ö†Ô∏è No user authenticated');
            updateStatus('Please sign in to continue');
            
            setTimeout(() => {
              showAuthError();
            }, 2000);

            // Login handler
            netlifyIdentity.on('login', (user) => {
              console.log('[ADMIN] ‚úì User logged in:', user.email);
              showSuccess('Welcome back, ' + (user.user_metadata?.full_name || 'Admin') + '!');
              setTimeout(() => {
                window.location.reload();
              }, 1000);
            });
          } else {
            const userName = user.user_metadata?.full_name || user.email;
            console.log('[ADMIN] ‚úì User authenticated:', userName);
            updateStatus('Welcome, ' + userName + '!');
            
            setTimeout(() => {
              hideLoading();
            }, 1500);
          }
        });

        // Logout handler
        netlifyIdentity.on('logout', () => {
          console.log('[ADMIN] üëã User logged out');
          localStorage.clear();
          sessionStorage.clear();
          window.location.href = '/';
        });

        // Error handler
        netlifyIdentity.on('error', err => {
          console.error('[ADMIN] ‚ùå Identity error:', err);
          updateStatus('Authentication error occurred');
          showAuthError();
        });

        // Close handler
        netlifyIdentity.on('close', () => {
          console.log('[ADMIN] Modal closed');
        });
      } else {
        console.error('[ADMIN] ‚ùå Netlify Identity not loaded');
        updateStatus('Error: Identity service unavailable');
        setTimeout(showAuthError, 2000);
      }

      // CMS Event Listeners
      if (window.CMS) {
        CMS.registerEventListener({
          name: 'prePublish',
          handler: ({ entry }) => {
            const title = entry.get('title') || entry.get('name') || 'Untitled';
            console.log('[ADMIN] üì§ Publishing:', title);
            return entry;
          }
        });

        CMS.registerEventListener({
          name: 'postPublish',
          handler: ({ entry }) => {
            const title = entry.get('title') || entry.get('name') || 'Content';
            console.log('[ADMIN] ‚úì Published:', title);
            showSuccess(title + ' published successfully!');
          }
        });

        CMS.registerEventListener({
          name: 'preSave',
          handler: ({ entry }) => {
            console.log('[ADMIN] üíæ Saving changes...');
            return entry;
          }
        });

        CMS.registerEventListener({
          name: 'postSave',
          handler: ({ entry }) => {
            console.log('[ADMIN] ‚úì Changes saved');
          }
        });

        console.log('[ADMIN] ‚úì CMS event listeners registered');
      }

      // Keyboard Shortcuts
      document.addEventListener('keydown', (e) => {
        // Ctrl/Cmd + K - Command palette
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
          e.preventDefault();
          console.log('[ADMIN] ‚å®Ô∏è Command palette triggered');
        }

        // Ctrl/Cmd + S - Save
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
          e.preventDefault();
          console.log('[ADMIN] ‚å®Ô∏è Save shortcut triggered');
        }

        // Escape - Close modals
        if (e.key === 'Escape') {
          console.log('[ADMIN] ‚å®Ô∏è Escape pressed');
        }
      });

      // Performance Monitoring
      window.addEventListener('load', () => {
        if (performance && performance.timing) {
          const perfData = performance.timing;
          const loadTime = perfData.loadEventEnd - perfData.navigationStart;
          console.log(`[ADMIN] ‚ö° Dashboard loaded in ${loadTime}ms`);
        }
      });

      // Network Status Monitoring
      window.addEventListener('online', () => {
        console.log('[ADMIN] üåê Network connection restored');
        showSuccess('Connection restored');
      });

      window.addEventListener('offline', () => {
        console.warn('[ADMIN] ‚ö†Ô∏è Network connection lost');
        alert('‚ö†Ô∏è Network connection lost. Changes may not be saved.');
      });

      // Prevent Accidental Navigation
      window.addEventListener('beforeunload', (e) => {
        const isDirty = document.querySelector('.nc-unsavedChanges-notification');
        if (isDirty) {
          e.preventDefault();
          e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
          return e.returnValue;
        }
      });

      // Service Worker Support
      if ('serviceWorker' in navigator) {
        console.log('[ADMIN] ‚úì Service Worker supported');
      }

      // Browser Compatibility Check
      const isModernBrowser = 
        'fetch' in window && 
        'Promise' in window && 
        'Symbol' in window &&
        'localStorage' in window;

      if (!isModernBrowser) {
        console.warn('[ADMIN] ‚ö†Ô∏è Browser may not be fully compatible');
        alert('‚ö†Ô∏è Your browser may not be fully compatible. Please use Chrome, Firefox, or Edge for the best experience.');
      }

      console.log('[ADMIN] ‚úÖ Admin dashboard scripts loaded successfully');
    })();
  </script>
</body>
</html>
